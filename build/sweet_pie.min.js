"use strict";var SWEETCHARTS=SWEETCHARTS||{};SWEETCHARTS.PIE=function(t,e,a,i,s){function r(e,s){if(a.exec(),!s||"object"!=typeof s)return t.console&&t.console.error(h.sErrorMSG.OPTION_TYPE_ERROR),null;this.nCount=0,this.aElPath=[],this.aArc=[],this.aStart=[],this.elWrapDiv=e,this.elChartSVG=e.querySelector(".sweet-chart"),this.elMaxValuePath=null,this.htCore={},this.aPieceKeys=[],this.aPieceValue=[],this.aColorSet=null,this.htPathOutlinePos={},this.elOver=null,this.reqId=null,this.htReq={},this.htTextPos={},this.oLegend=null,this.bDonutChart=this.bDonutChart||!1,this.bShadow=!this.bDonutChart,this.bMobile=i.isMobile(),console.log("3",i.isMobile());try{this.setOption(s)}catch(r){t.console.error(r)}this.htCore.startX=this.htCore.centerX+this.htCore.radius,this.htCore.startY=this.htCore.centerY,this.makeCreatePathElement()}var h={minPieceCount:2,nAniTime:16,xmlns:"http://www.w3.org/2000/svg",maxAngle:359.9999,sErrorMSG:{OPTION_TYPE_ERROR:"option type is wrong",REQ_PIECE_DATA:"Require pie's piece datas",SUM_ERROR:"the sum of pieceData should be 100"},htDefaultCoreValue:{radius:50,nMaxAngle:360,nMilliSecondCycle:1e3,nIncrease:5,sRandomColorType:""},CSS:{chartShadow:"drop-shadow(4px 5px 2.2px rgba(0,0,0,0.25))"},colorType:{a:["#ffcdd2","#f8bbd0","#e1bee7","#d1c4e9","#c5cae9","#bbdefb","#b3e5fc","#b2ebf2","#b2dfdb","#c8e6c9","#dcedc8","#f0f4c3","#fff9c4","#ffecb3","#ffe0b2","#ffccbc","#d7ccc8","#f5f5f5","#cfd8dc"],b:["#FF8A80","#FF80AB","#EA80FC","#B388FF","#8C9EFF","#82B1FF","#80D8FF","#84FFFF","#A7FFEB","#B9F6CA","#CCFF90","#F4FF81","#FFFF8D","#FFE57F","#FFD180","#FF9E80"],c:["#f44336","#e91e63","#9c27b0","#673ab7","#3f51b5","#2196f3","#03a9f4","#00bcd4","#009688","#4caf50","#8bc34a","#cddc39","#ffeb3b","#ffc107","#ff9800","#ff5722","#795548","#9e9e9e","#607d8b"],d:["#51574a","#447c69","#74c493","#8e8c6d","#e4bf80","#e9d78e","#e2975d","#f19670","#e16552","#c94a53","#be5168","#a34974","#993767","#65387d","#4e2472","#9163b6","#e279a3","#e0598b","#7c9fb0","#5698c4","#9abf88"]}};return r.prototype={setOption:function(t){var e=t.core;if(this.htPiece=t.htPiece,this.aPieceKeys=Object.keys(this.htPiece),this.aPieceValue=this.aPieceKeys.map(function(t){return this.htPiece[t].data},this),this.aPieceValue.length<h.minPieceCount)throw Error(h.sErrorMSG.REQ_PIECE_DATA);var a=this.aPieceValue.reduce(function(t,e){return"number"!=typeof t&&(t=+t),t+e});this.aPieceValue.forEach(function(t,e){this.aPieceValue[e]=Number((t/a*100).toFixed(2))},this);for(var i in h.htDefaultCoreValue)this.htCore[i]=e[i]||h.htDefaultCoreValue[i];this.htCore.centerX=e.centerX||.7*this.elWrapDiv.clientWidth/2,this.htCore.centerY=e.centerY||this.elWrapDiv.clientHeight/2,this.aColorSet=this.htCore.sRandomColorType.toLowerCase()in h.colorType?this.getRandomColorArray(this.htCore.sRandomColorType.toLowerCase(),this.aPieceValue.length):this.aPieceKeys.map(function(t){return this.htPiece[t].color},this),this.htCore.nIncrease=360*h.nAniTime/(e.nMilliSecondCycle-100)},getRandomColorArray:function(t,e){var a=i.getRandomIndex(h.colorType[t].length-1,e),s=a.map(function(e){return h.colorType[t][e]});return s},createPathElements:function(t,a,s,r,n){var o=e.createElementNS(h.xmlns,"g");this.elChartSVG.appendChild(o),t[a]=e.createElementNS(h.xmlns,"path");var l=n?"InnerPath":"elPath";i.setAttrs(t[a],{"class":l+a,d:s,style:"stroke:white;fill:"+r}),o.appendChild(t[a])},getCoordProperty:function(t,e,a,i,s,r,h){var n="M "+t+" "+e+" A "+s+" "+s+" 0 0 1 "+a+" "+i+" L "+r+" "+h+" Z";return n},setDataForSet:function(t){var e=[];e[t]=this.aElPath[t].pathSegList,this.aArc[t]=e[t].getItem(1),this.aStart[t]=e[t].getItem(0)},makeCreatePathElement:function(){for(var t=this.aPieceValue.length,e=this.htCore,a=this.getCoordProperty(e.startX,e.startY,e.startX,e.startY,e.radius,e.centerX,e.centerY),i=0;t>i;i++)this.createPathElements(this.aElPath,i,a,this.aColorSet[i]),this.setDataForSet(i);this.bDonutChart&&this.makeCircle()},runAnimation:function(){this.nR=0;var e=this.htCore.nMaxAngle,a=this.htCore.nIncrease;return this.nCount>=h.maxAngle?void this.execAfterAnimation():(this.nCount=this.nCount+a,this.nCount>e-a&&(this.nCount=h.maxAngle),this.aPieceValue.forEach(this.setSVGPathAttribute,this),void t.requestAnimationFrame(this.runAnimation.bind(this)))},execAfterAnimation:function(){this.showTextData(),this.bShadow&&this.addShadow(),this.oLegend=new s(this.elWrapDiv,this.aPieceKeys,this.aColorSet),this.oLegend.makeLegend(),this.registerOverEffect(),this.elMaxValuePath=this.aElPath[this.aPieceValue.indexOf(Math.max.apply(null,this.aPieceValue))],t.setTimeout(function(){this.overHandler({target:this.elMaxValuePath})}.bind(this),200),this.bDonutChart&&this.execDonutAfterProcess()},registerOverEffect:function(){var t=this.getEventType();this.elChartSVG.addEventListener(t,this.overHandler.bind(this)),this.elChartSVG.addEventListener("mousemove",this.moveHandler.bind(this))},getEventType:function(){return this.bMobile?"touchstart":"mouseover"},moveHandler:function(t){if("svg"===t.target.nodeName&&this.elOver){var e=i.getDistanceFromCircleCenter(t,this.htCore);e<this.htCore.radius||this.elOver&&(this.oLegend&&this.oLegend.clearEmphasizeMenu(),this.rollback())}},overHandler:function(t){console.log("overHandler",t.type);var e=t.target.nodeName;if(!("path"===e&&t.relatedTarget&&"text"===t.relatedTarget.nodeName||"mouseover"===t.type&&"text"===e||0===t.target.className.baseVal.lastIndexOf("In",0))){var a="text"===e?t.target.previousSibling:t.target;if("path"!==e&&"text"!==e){var s=i.getDistanceFromCircleCenter(t,this.htCore);return void(s>this.htCore.radius&&this.elOver&&(this.oLegend&&this.oLegend.clearEmphasizeMenu(),this.rollback()))}this.elOver&&this.elOver!==a&&this.rollback(),this.cancelAllAnimationFrame(),this.movePiece(a,this.htTextPos[a.className.baseVal].x,this.htTextPos[a.className.baseVal].y,30);var r=Number(a.className.baseVal.substr(6));this.oLegend.emphasizeMenu(r),this.bDonutChart&&this.changeCenterTextMessage(this.aPieceKeys[r]),this.elOver=a}},rollback:function(){if(this.cancelAllAnimationFrame(),i.setAttrs(this.elOver,{transform:"translate(0,0)"}),i.setAttrs(this.elOver.nextElementSibling,{transform:"translate("+this.htTextPos[this.elOver.className.baseVal].x+","+this.htTextPos[this.elOver.className.baseVal].y+")"}),this.bDonutChart){var t=this.elChartSVG.querySelector(".InnerPath"+Number(this.elOver.className.baseVal.substr(6)));i.setAttrs(t,{transform:"translate(0,0)"})}this.elOver=null},cancelAllAnimationFrame:function(){for(var e in this.htReq)t.cancelAnimationFrame(this.htReq[e])},movePiece:function(e,a,i,s){var r,h,n,o,l;if(r=this.htPathOutlinePos[e.className.baseVal],h=Math.abs(r[1]/r[0]),n=r[0]/Math.abs(r[0]),o=r[1]/Math.abs(r[1]),l=Math.sqrt(s/(Math.pow(h,2)+1)),e.setAttribute("transform","translate("+l*n+","+l*h*o+")"),e.nextElementSibling.setAttribute("transform","translate("+(a+l*n)+","+(i+l*h*o)+")"),this.bDonutChart){var c=this.elChartSVG.querySelector(".InnerPath"+Number(e.className.baseVal.substr(6)));c.setAttribute("transform","translate("+l*n+","+l*h*o+")")}s+=20,300>s&&(this.reqId=t.requestAnimationFrame(this.movePiece.bind(this,e,a,i,s)),this.htReq[e.className.baseVal]=this.reqId)},setSVGPathAttribute:function(t,e){var a=this.htCore.radius,i=this.htCore.startX,s=this.htCore.startY;e>0&&(this.aStart[e].x=this.aArc[e-1].x,this.aStart[e].y=this.aArc[e-1].y);var r=this.nCount*t/100;return this.nR+=r,this.aArc[e].x=i-a+Number(Math.cos(Math.PI/180*this.nR))*a,this.aArc[e].y=s+Number(Math.sin(Math.PI/180*this.nR))*a,r>=180&&!this.aArc[e].largeArcFlag&&(this.aArc[e].largeArcFlag=1),this.nR},showTextData:function(){for(var t=this.bDonutChart?1.3:1.6,e=this.aPieceValue.map(this.setSVGPathAttribute,this),a=0,s=e.length;s>a;a++){var r=i.getPosition(e,this.htCore,a,this.pushCenterPosition.bind(this),t);this.appendDataInText(a,r.x,r.y)}},pushCenterPosition:function(t,e,a){this.htPathOutlinePos["elPath"+a]=[t,e]},appendDataInText:function(t,a,s){var r=e.createElementNS(h.xmlns,"text"),n=this.elChartSVG.querySelector("g:nth-of-type("+(t+1)+")"),o=Number(this.aPieceValue[t].toFixed(1)),l=Math.round(.4*this.aPieceValue[t]),c=a-2*l;i.setAttrs(r,{transform:"translate("+c+" "+s+")",fill:"#000","font-size":8+l+""}),r.textContent=o%1===0?o.toFixed(0)+"%":o+"%",n.appendChild(r),this.htTextPos[n.firstElementChild.className.baseVal]={x:c,y:s}},addShadow:function(){var t=h.CSS.chartShadow;this.elChartSVG.style.webkitFilter=t,this.elChartSVG.style.filter=t},constructor:r},r}(window,document,SWEETCHARTS.polyfill,SWEETCHARTS.u,SWEETCHARTS.LegendManager),"function"==typeof window.define&&window.define.amd&&window.define(["sweet_pie.min"],function(){return SWEETCHARTS.PIE});